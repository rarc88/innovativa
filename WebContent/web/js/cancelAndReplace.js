OB.CancelAndReplace={};OB.CancelAndReplace.ClientSideEventHandlersPreSaveUpdate={};OB.CancelAndReplace.ClientSideEventHandlersPreDelete={};OB.CancelAndReplace.SALES_ORDERLINES_TAB="187";OB.CancelAndReplace.ClientSideEventHandlersPreSaveUpdate.showMessage=function(a,d,b,h,g){var e=h.data,c=e.orderedQuantity,f=[];
a.messageBar.keepOnAutomaticRefresh=true;callback=function(j,l,k){if(l&&l.result.length&&l.result[0].deliveredQuantity>c){a.messageBar.setMessage(isc.OBMessageBar.TYPE_ERROR,null,OB.I18N.getLabel("CannotOrderLessThanDeliveredInCancelReplace"));return;}OB.EventHandlerRegistry.callbackExecutor(a,d,b,h,g);
};if(e.replacedorderline&&!h.isNewRecord&&a.getParentRecord().documentStatus==="TMP"){f.push(e);OB.RemoteCallManager.call("org.openbravo.common.actionhandler.CancelAndReplaceGetCancelledOrderLine",{records:f},{},callback);}else{OB.EventHandlerRegistry.callbackExecutor(a,d,b,h,g);}};OB.EventHandlerRegistry.register(OB.CancelAndReplace.SALES_ORDERLINES_TAB,OB.EventHandlerRegistry.PRESAVE,OB.CancelAndReplace.ClientSideEventHandlersPreSaveUpdate.showMessage,"OBCancelAndReplace_ShowMessage");
OB.CancelAndReplace.ClientSideEventHandlersPreDelete.showMessage=function(g,c,a,b,d){var j=b.recordsToDelete,f=[],e,h;g.messageBar.keepOnAutomaticRefresh=true;callback=function(k,n,m){for(i=0;i<n.result.length;i++){e=n.result[i].record;h=n.result[i].deliveredQuantity;if(h!==0){var l=[];l.push(e.lineNo);
l.push(e.product$_identifier);g.messageBar.setMessage(isc.OBMessageBar.TYPE_ERROR,null,OB.I18N.getLabel("CannotDeleteLineWithDeliveredQtyInReplacementLine",l));return;}}OB.EventHandlerRegistry.callbackExecutor(g,c,a,b,d);};if(g.getParentRecord().documentStatus==="TMP"){for(i=0;i<j.length;i++){e=j[i];
if(e.replacedorderline){f.push(e);}}if(f.length){OB.RemoteCallManager.call("org.openbravo.common.actionhandler.CancelAndReplaceGetCancelledOrderLine",{records:f},{},callback);}else{OB.EventHandlerRegistry.callbackExecutor(g,c,a,b,d);}}else{OB.EventHandlerRegistry.callbackExecutor(g,c,a,b,d);}};OB.EventHandlerRegistry.register(OB.CancelAndReplace.SALES_ORDERLINES_TAB,OB.EventHandlerRegistry.PREDELETE,OB.CancelAndReplace.ClientSideEventHandlersPreDelete.showMessage,"OBCancelAndReplace_ShowMessage");
