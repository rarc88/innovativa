<?xml version="1.0"?>
  <database name="VIEW SFB_BUDGET_COMMITEMS_V">
    <view name="SFB_BUDGET_COMMITEMS_V"><![CDATA[SELECT CASE WHEN COALESCE(dt.isreversal, 'N') = 'Y' OR COALESCE(dt.docbasetype, 'APC') = 'ARC' OR COALESCE(dt.isreversal, 'N') = 'Y' THEN CASE WHEN cil.line_gross_amount <> 0 THEN cil.line_gross_amount ELSE cil.linenetamt + cil.taxamt END * (-1) ELSE CASE WHEN col.line_gross_amount <> 0 THEN col.line_gross_amount ELSE col.linenetamt + ((SELECT sum(c_orderlinetax.taxamt) AS sum FROM c_orderlinetax WHERE c_orderlinetax.c_orderline_id = col.c_orderline_id)) END END AS totalamt, bl.sfb_budget_line_id AS budgetline_id, co.dateordered AS date_transaction, bcl.sfb_budget_cert_line_id AS certificate_id FROM c_orderline col LEFT JOIN c_order co ON col.c_order_id = co.c_order_id FULL JOIN c_invoiceline cil ON col.c_orderline_id = cil.c_orderline_id LEFT JOIN c_invoice ci ON cil.c_invoice_id = ci.c_invoice_id LEFT JOIN c_doctype dt ON dt.c_doctype_id = ci.c_doctype_id JOIN sfb_budget_cert_line bcl ON bcl.sfb_budget_cert_line_id = COALESCE(col.em_sfb_budget_cert_line_id, cil.em_sfb_budget_cert_line_id) JOIN sfb_budget_certificate bc ON bcl.sfb_budget_certificate_id = bc.sfb_budget_certificate_id JOIN sfb_budget_line bl ON bcl.ad_client_id = bl.ad_client_id AND bcl.ad_org_id = bl.ad_org_id AND bcl.c_costcenter_id = bl.c_costcenter_id AND bcl.user1_id = bl.user1_id AND bcl.sfb_budget_item_id = bl.sfb_budget_item_id AND bc.sfb_budget_area_id = bl.sfb_budget_area_id JOIN sfb_budget_version bv ON bl.sfb_budget_version_id = bv.sfb_budget_version_id AND bv.version_status = 'AP' JOIN sfb_budget b ON bv.sfb_budget_id = b.sfb_budget_id AND bc.type_of_budget = b.type_of_budget AND bc.c_year_id = b.c_year_id WHERE (co.issotrx = 'N' OR ci.issotrx = 'N') AND (col.em_sfb_budget_cert_line_id IS NOT NULL OR cil.em_sfb_budget_cert_line_id IS NOT NULL) AND (col.em_sfb_isnotbudgetable = 'N' OR cil.em_sfb_isnotbudgetable = 'N') GROUP BY col.c_orderline_id, (CASE WHEN COALESCE(dt.isreversal, 'N') = 'Y' OR COALESCE(dt.docbasetype, 'APC') = 'ARC' OR COALESCE(dt.isreversal, 'N') = 'Y' THEN CASE WHEN cil.line_gross_amount <> 0 THEN cil.line_gross_amount ELSE cil.linenetamt + cil.taxamt END * (-1) ELSE CASE WHEN col.line_gross_amount <> 0 THEN col.line_gross_amount ELSE col.linenetamt + ((SELECT sum(c_orderlinetax.taxamt) AS sum FROM c_orderlinetax WHERE c_orderlinetax.c_orderline_id = col.c_orderline_id)) END END), bl.sfb_budget_line_id, co.dateordered, bcl.sfb_budget_cert_line_id UNION ALL SELECT bcl.committed_value AS totalamt, bl.sfb_budget_line_id AS budgetline_id, bc.date_issue AS date_transaction, bcl.sfb_budget_cert_line_id AS certificate_id FROM sfb_budget_line bl LEFT JOIN sfb_budget_version bv ON bl.sfb_budget_version_id = bv.sfb_budget_version_id LEFT JOIN sfb_budget b ON bv.sfb_budget_id = b.sfb_budget_id, sfb_budget_cert_line bcl LEFT JOIN sfb_budget_certificate bc ON bcl.sfb_budget_certificate_id = bc.sfb_budget_certificate_id WHERE bcl.ad_client_id = bl.ad_client_id AND bcl.ad_org_id = bl.ad_org_id AND bcl.c_costcenter_id = bl.c_costcenter_id AND bcl.user1_id = bl.user1_id AND bcl.sfb_budget_item_id = bl.sfb_budget_item_id AND bc.sfb_budget_area_id = bl.sfb_budget_area_id AND bv.version_status = 'AP' AND bc.type_of_budget = b.type_of_budget AND bc.c_year_id = b.c_year_id AND bc.type_of_certificate = 'SSBP_P' AND bc.process_executed = 'Y' UNION ALL SELECT va.totalamt_viatical AS totalamt, bl.sfb_budget_line_id AS budgetline_id, v.viaticaldate AS date_transaction, bcl.sfb_budget_cert_line_id AS certificate_id FROM ssve_viatical_details_aux2 va LEFT JOIN ssve_viatical_details_aux4 vs ON vs.ssve_viatical_id = va.ssve_viatical_id AND vs.sfb_budget_cert_line_id = va.sfb_budget_cert_line_id LEFT JOIN ssve_viatical v ON v.ssve_viatical_id = va.ssve_viatical_id, sfb_budget_line bl LEFT JOIN sfb_budget_version bv ON bl.sfb_budget_version_id = bv.sfb_budget_version_id LEFT JOIN sfb_budget b ON bv.sfb_budget_id = b.sfb_budget_id, sfb_budget_cert_line bcl LEFT JOIN sfb_budget_certificate bc ON bcl.sfb_budget_certificate_id = bc.sfb_budget_certificate_id WHERE bcl.ad_client_id = bl.ad_client_id AND bcl.ad_org_id = bl.ad_org_id AND bcl.c_costcenter_id = bl.c_costcenter_id AND bcl.user1_id = bl.user1_id AND bcl.sfb_budget_item_id = bl.sfb_budget_item_id AND bc.sfb_budget_area_id = bl.sfb_budget_area_id AND bv.version_status = 'AP' AND bc.type_of_budget = b.type_of_budget AND bc.c_year_id = b.c_year_id AND va.sfb_budget_cert_line_id = bcl.sfb_budget_cert_line_id UNION ALL SELECT CASE WHEN gl.amtsourcedr = 0 THEN gl.amtsourcecr * CASE WHEN gl.em_sfb_affectbudget = 'Y' THEN (-1) ELSE 1 END ELSE gl.amtsourcedr * CASE WHEN gl.em_sfbin_affectincomebudget = 'Y' THEN (-1) ELSE 1 END END AS totalamt, bl.sfb_budget_line_id AS budgetline_id, g.dateacct AS date_transaction, bcl.sfb_budget_cert_line_id AS certificate_id FROM gl_journalline gl LEFT JOIN gl_journal g ON gl.gl_journal_id = g.gl_journal_id, sfb_budget_cert_line bcl LEFT JOIN sfb_budget_certificate bc ON bcl.sfb_budget_certificate_id = bc.sfb_budget_certificate_id, sfb_budget_line bl LEFT JOIN sfb_budget_version bv ON bl.sfb_budget_version_id = bv.sfb_budget_version_id LEFT JOIN sfb_budget b ON bv.sfb_budget_id = b.sfb_budget_id WHERE bcl.ad_client_id = bl.ad_client_id AND bcl.ad_org_id = bl.ad_org_id AND bcl.c_costcenter_id = bl.c_costcenter_id AND bcl.user1_id = bl.user1_id AND bcl.sfb_budget_item_id = bl.sfb_budget_item_id AND bc.sfb_budget_area_id = bl.sfb_budget_area_id AND bv.version_status = 'AP' AND bc.type_of_budget = b.type_of_budget AND bc.c_year_id = b.c_year_id AND gl.em_sfb_budget_cert_line_id = bcl.sfb_budget_cert_line_id AND gl.em_sfb_budget_cert_line_id IS NOT NULL AND g.docstatus = 'CO' UNION ALL SELECT bd.totalamt, bl.sfb_budget_line_id AS budgetline_id, bd.budgetdate AS date_transaction, bcl.sfb_budget_cert_line_id AS certificate_id FROM scbd_budget_direct bd, sfb_budget_cert_line bcl LEFT JOIN sfb_budget_certificate bc ON bcl.sfb_budget_certificate_id = bc.sfb_budget_certificate_id, sfb_budget_line bl LEFT JOIN sfb_budget_version bv ON bl.sfb_budget_version_id = bv.sfb_budget_version_id LEFT JOIN sfb_budget b ON bv.sfb_budget_id = b.sfb_budget_id WHERE bcl.ad_client_id = bl.ad_client_id AND bcl.ad_org_id = bl.ad_org_id AND bcl.c_costcenter_id = bl.c_costcenter_id AND bcl.user1_id = bl.user1_id AND bcl.sfb_budget_item_id = bl.sfb_budget_item_id AND bc.sfb_budget_area_id = bl.sfb_budget_area_id AND bv.version_status = 'AP' AND bc.type_of_budget = b.type_of_budget AND bc.c_year_id = b.c_year_id AND bd.sfb_budget_cert_line_id = bcl.sfb_budget_cert_line_id]]></view>
  </database>
