<?xml version="1.0"?>
  <database name="VIEW SSFIEG_FIN_PAYABLE_CREDIT_V">
    <view name="SSFIEG_FIN_PAYABLE_CREDIT_V"><![CDATA[(((SELECT get_uuid() AS ssfieg_fin_payable_credit_v_id, f.ad_client_id, f.ad_org_id, f.isactive, now() AS created, f.createdby, now() AS updated, f.updatedby, f.dateacct, 'PAGO NA' AS tipo_transaccion, a.documentno, 0 AS valor_contabilidad, 0 AS base_ret_renta, 0 AS ret_renta, 0 AS base_ret_iva, 0 AS ret_iva, 0 AS base_iva, 0 AS iva, round(f.amtacctcr, 2) AS valor_final, 'NA' AS tipo_partida, NULL AS sfb_budget_item_id FROM fact_acct f JOIN fin_payment a ON a.fin_payment_id = f.record_id JOIN fin_payment_detail b ON a.fin_payment_id = b.fin_payment_id AND f.line_id = b.fin_payment_detail_id WHERE (f.acctvalue IN (SELECT c_validcombination.combination FROM c_validcombination WHERE (c_validcombination.c_validcombination_id IN (SELECT ssfieg_fin_acct_payable.account_id FROM ssfieg_fin_acct_payable)))) AND f.amtacctcr <> 0 UNION ALL SELECT get_uuid() AS ssfieg_fin_payable_credit_v_id, f.ad_client_id, f.ad_org_id, f.isactive, now() AS created, f.createdby, now() AS updated, f.updatedby, f.dateacct, 'PAGO PRESUPUESTO' AS tipo_transaccion, a.documentno, 0 AS valor_contabilidad, 0 AS base_ret_renta, 0 AS ret_renta, 0 AS base_ret_iva, 0 AS ret_iva, 0 AS base_iva, 0 AS iva, round(f.amtacctcr, 2) AS valor_final, substr(d.value, 1, 2) AS tipo_partida, d.sfb_budget_item_id FROM fact_acct f JOIN fin_payment a ON a.fin_payment_id = f.record_id JOIN fin_payment_detail b ON a.fin_payment_id = b.fin_payment_id JOIN sfb_budget_cert_line c ON b.em_sfb_budget_cert_line_id = c.sfb_budget_cert_line_id JOIN sfb_budget_item d ON c.sfb_budget_item_id = d.sfb_budget_item_id WHERE f.line_id IS NULL AND (f.acctvalue IN (SELECT c_validcombination.combination FROM c_validcombination WHERE (c_validcombination.c_validcombination_id IN (SELECT ssfieg_fin_acct_payable.account_id FROM ssfieg_fin_acct_payable)))) AND f.amtacctcr <> 0) UNION ALL SELECT get_uuid() AS ssfieg_fin_payable_credit_v_id, f.ad_client_id, f.ad_org_id, f.isactive, now() AS created, f.createdby, now() AS updated, f.updatedby, f.dateacct, 'VIATICO' AS tipo_transaccion, a.documentno, 0 AS valor_contabilidad, 0 AS base_ret_renta, 0 AS ret_renta, 0 AS base_ret_iva, 0 AS ret_iva, 0 AS base_iva, 0 AS iva, round(b.linenetamt, 2) AS valor_final, COALESCE(substr(i.value, 1, 2), 'NA') AS tipo_partida, i.sfb_budget_item_id FROM fact_acct f JOIN ssve_viatical_settlement a ON a.ssve_viatical_settlement_id = f.record_id JOIN ssve_viatsettlementline b ON a.ssve_viatical_settlement_id = b.ssve_viatical_settlement_id LEFT JOIN sfb_budget_cert_line h ON b.sfb_budget_cert_line_id = h.sfb_budget_cert_line_id LEFT JOIN sfb_budget_item i ON h.sfb_budget_item_id = i.sfb_budget_item_id WHERE (f.acctvalue IN (SELECT c_validcombination.combination FROM c_validcombination WHERE (c_validcombination.c_validcombination_id IN (SELECT ssfieg_fin_acct_payable.account_id FROM ssfieg_fin_acct_payable)))) AND f.amtacctcr <> 0) UNION ALL SELECT get_uuid() AS ssfieg_fin_payable_credit_v_id, f.ad_client_id, f.ad_org_id, f.isactive, now() AS created, f.createdby, now() AS updated, f.updatedby, f.dateacct, 'FACTURA' AS tipo_transaccion, a.documentno, f.amtacctcr AS valor_contabilidad, c.taxbaseamt AS base_ret_renta, c.taxamt AS ret_renta, CASE WHEN d.taxbaseamt = 0 THEN f.amtacctcr ELSE d.taxbaseamt END AS base_ret_iva, d.taxamt AS ret_iva, CASE WHEN g.taxbaseamt = 0 THEN f.amtacctcr ELSE g.taxbaseamt END AS base_iva, g.taxamt AS iva, CASE WHEN (g.taxbaseamt + g.taxamt + c.taxamt + d.taxamt) = 0 THEN f.amtacctcr ELSE g.taxbaseamt + g.taxamt + c.taxamt + d.taxamt END AS valor_final, substr(i.value, 1, 2) AS tipo_partida, i.sfb_budget_item_id FROM fact_acct f JOIN c_invoice a ON a.c_invoice_id = f.record_id JOIN c_invoiceline b ON a.c_invoice_id = b.c_invoice_id LEFT JOIN c_invoicetax c ON b.em_sswh_invoicetax_income_id = c.c_invoicetax_id LEFT JOIN c_invoicetax d ON b.em_sswh_invoicetax_vat_id = d.c_invoicetax_id LEFT JOIN c_tax e ON c.c_tax_id = e.c_tax_id JOIN c_invoicelinetax g ON b.c_invoiceline_id = g.c_invoiceline_id LEFT JOIN sfb_budget_cert_line h ON b.em_sfb_budget_cert_line_id = h.sfb_budget_cert_line_id JOIN sfb_budget_item i ON h.sfb_budget_item_id = i.sfb_budget_item_id WHERE (f.acctvalue IN (SELECT c_validcombination.combination FROM c_validcombination WHERE (c_validcombination.c_validcombination_id IN (SELECT ssfieg_fin_acct_payable.account_id FROM ssfieg_fin_acct_payable)))) AND f.amtacctcr <> 0) UNION ALL SELECT get_uuid() AS ssfieg_fin_payable_credit_v_id, f.ad_client_id, f.ad_org_id, f.isactive, now() AS created, f.createdby, now() AS updated, f.updatedby, f.dateacct, 'ASIENTO MANUAL' AS tipo_transaccion, gl.documentno, 0 AS valor_contabilidad, 0 AS base_ret_renta, 0 AS ret_renta, 0 AS base_ret_iva, 0 AS ret_iva, 0 AS base_iva, 0 AS iva, round(f.amtacctcr, 2) AS valor_final, 'NA' AS tipo_partida, NULL AS sfb_budget_item_id FROM fact_acct f JOIN gl_journal gl ON f.record_id = gl.gl_journal_id WHERE (f.acctvalue IN (SELECT c_validcombination.combination FROM c_validcombination WHERE (c_validcombination.c_validcombination_id IN (SELECT ssfieg_fin_acct_payable.account_id FROM ssfieg_fin_acct_payable)))) AND f.amtacctcr <> 0]]></view>
  </database>
