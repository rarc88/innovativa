<?xml version="1.0"?>
  <database name="VIEW SSFI_INVOICE_SUMMARY_V">
    <view name="SSFI_INVOICE_SUMMARY_V"><![CDATA[SELECT get_uuid() AS ssfi_invoice_summary_v_id, impuesto.ad_client_id, impuesto.ad_org_id, impuesto.isactive, impuesto.created, impuesto.createdby, impuesto.updated, impuesto.updatedby, impuesto.c_invoice_id, sum(impuesto.importe_bruto) AS importe_bruto, sum(impuesto.importe_imponible) AS importe_imponible, sum(impuesto.impuesto) AS impuesto, sum(impuesto.basecero) AS basecero, sum(impuesto.base12) AS base12, sum(impuesto.iva) AS iva12 FROM (SELECT ci.c_invoice_id, ci.ad_client_id, ci.ad_org_id, ci.isactive, ci.created, ci.createdby, ci.updated, ci.updatedby, sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate = 0 THEN cilt.taxbaseamt WHEN ct.istaxdeductable = 'Y' AND ct.rate <> 0 THEN cilt.taxbaseamt ELSE NULL END) + sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate <> 0 THEN cilt.taxamt ELSE 0 END) AS importe_bruto, sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate = 0 THEN cilt.taxbaseamt ELSE 0 END + CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate <> 0 THEN cilt.taxbaseamt ELSE 0 END + CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate = 0 THEN cilt.taxamt ELSE 0 END) AS importe_imponible, sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate <> 0 THEN cilt.taxamt ELSE 0 END) AS impuesto, sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate = 0 THEN cilt.taxbaseamt ELSE 0 END) AS basecero, sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate <> 0 THEN cilt.taxbaseamt ELSE 0 END) AS base12, sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate <> 0 THEN cilt.taxamt ELSE 0 END) AS iva FROM c_invoice ci JOIN c_invoiceline cil ON cil.c_invoice_id = ci.c_invoice_id JOIN m_product mp ON mp.m_product_id = cil.m_product_id JOIN c_invoicelinetax cilt ON cilt.c_invoice_id = ci.c_invoice_id AND cil.c_invoiceline_id = cilt.c_invoiceline_id JOIN c_tax ct ON ct.c_tax_id = cilt.c_tax_id GROUP BY ci.c_invoice_id, ci.ad_client_id, ci.ad_org_id, ci.isactive, ci.created, ci.createdby, ci.updated, ci.updatedby) impuesto GROUP BY impuesto.c_invoice_id, impuesto.ad_client_id, impuesto.ad_org_id, impuesto.isactive, impuesto.created, impuesto.createdby, impuesto.updated, impuesto.updatedby]]></view>
  </database>
