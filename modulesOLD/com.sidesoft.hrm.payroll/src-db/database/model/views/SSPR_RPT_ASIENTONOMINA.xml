<?xml version="1.0"?>
  <database name="VIEW SSPR_RPT_ASIENTONOMINA">
    <view name="SSPR_RPT_ASIENTONOMINA"><![CDATA[SELECT aa.cuenta, aa.tercero, aa.descripcioncuenta, aa.movimiento, aa.debe, aa.haber, aa.monto, aa.detalle, aa.periodo, aa.sspr_rpt_asientonomina_id, aa.ad_client_id, aa.ad_org_id, aa.created, aa.createdby, aa.updated, aa.updatedby, aa.isactive FROM (SELECT CASE e.isaccountcharge WHEN 'Y' THEN to_char(cvc2.alias) ELSE CASE e.isliability WHEN 'Y' THEN to_char(cvc2.alias) ELSE CASE e.isexpend WHEN 'Y' THEN to_char(cvc2.alias) ELSE to_char('XXXX') END END END AS cuenta, CASE e.isexpend WHEN 'Y' THEN rtrim(to_char((SELECT c_project.name FROM c_project WHERE c_project.c_project_id = f.em_sspr_project_id))) ELSE CASE e.isaccountcharge WHEN 'Y' THEN (SELECT to_char(c_bpartner.c_bpartner_id) AS to_char FROM c_bpartner WHERE c_bpartner.c_bpartner_id = a.c_bpartner_id) ELSE a.c_bpartner_id END END AS tercero, CASE e.isaccountcharge WHEN 'Y' THEN (SELECT to_char(c_validcombination.description) AS to_char FROM c_validcombination WHERE c_validcombination.c_validcombination_id = e.c_credit_acct) ELSE CASE e.isexpend WHEN 'Y' THEN (SELECT to_char(c_validcombination.description) AS to_char FROM c_validcombination WHERE c_validcombination.c_validcombination_id = e.c_debit_acct) ELSE CASE e.isliability WHEN 'Y' THEN (SELECT to_char(c_validcombination.description) AS to_char FROM c_validcombination WHERE c_validcombination.c_validcombination_id = e.c_credit_acct) ELSE to_char('XXXX') END END END AS descripcioncuenta, CASE e.isaccountcharge WHEN 'Y' THEN to_char('H') ELSE CASE e.isexpend WHEN 'Y' THEN to_char('D') ELSE CASE e.isliability WHEN 'Y' THEN to_char('H') ELSE to_char('XXXX') END END END AS movimiento, CASE e.isaccountcharge WHEN 'Y' THEN 0 ELSE CASE e.isexpend WHEN 'Y' THEN round(b.amount, 2) ELSE CASE e.isliability WHEN 'Y' THEN 0 ELSE 0 END END END AS debe, CASE e.isaccountcharge WHEN 'Y' THEN round(b.amount, 2) ELSE CASE e.isexpend WHEN 'Y' THEN 0 ELSE CASE e.isliability WHEN 'Y' THEN round(b.amount, 2) ELSE 0 END END END AS haber, round(b.amount, 2) AS monto, to_char((c.name || ' - ') || (((SELECT c_bpartner.name FROM c_bpartner WHERE c_bpartner.c_bpartner_id = a.c_bpartner_id)))) AS detalle, (SELECT c_period.name FROM c_period WHERE c_period.c_period_id = d.c_period_id) AS periodo, a.sspr_payroll_ticket_id AS sspr_rpt_asientonomina_id, d.ad_client_id, d.ad_org_id, a.created, a.createdby, a.updated, a.updatedby, to_char(a.isactive) AS isactive FROM sspr_payroll_ticket a LEFT JOIN sspr_payroll_ticket_concept b ON a.sspr_payroll_ticket_id = b.sspr_payroll_ticket_id LEFT JOIN sspr_concept c ON b.sspr_concept_id = c.sspr_concept_id LEFT JOIN sspr_payroll d ON a.sspr_payroll_id = d.sspr_payroll_id LEFT JOIN c_bpartner f ON a.c_bpartner_id = f.c_bpartner_id LEFT JOIN sspr_concept_acct e ON c.sspr_concept_id = e.sspr_concept_id AND f.em_sspr_category_acct_id = e.sspr_category_acct_id LEFT JOIN c_validcombination g ON e.c_debit_acct = g.c_validcombination_id OR e.c_credit_acct = g.c_validcombination_id LEFT JOIN c_period h ON d.c_period_id = h.c_period_id LEFT JOIN c_validcombination cvc1 ON e.c_credit_acct = cvc1.c_validcombination_id LEFT JOIN c_validcombination cvc2 ON e.c_debit_acct = cvc2.c_validcombination_id WHERE e.isaccountcharge IS NOT NULL AND e.isexpend IS NOT NULL AND e.isliability IS NOT NULL AND b.amount <> 0 AND d.ispayroll = 'Y' UNION ALL SELECT DISTINCT to_char((SELECT c_validcombination.alias FROM c_validcombination WHERE c_validcombination.c_validcombination_id = (((SELECT sspr_acctledger.c_validcombination_id FROM sspr_acctledger))))) AS cuenta, '' AS tercero, to_char((SELECT c_validcombination.description FROM c_validcombination WHERE c_validcombination.c_validcombination_id = (((SELECT sspr_acctledger.c_validcombination_id FROM sspr_acctledger))))) AS descripcioncuenta, CASE WHEN ((SELECT sspr_acctledger.ishaveaccount FROM sspr_acctledger WHERE sspr_acctledger.c_validcombination_id = (((SELECT c_validcombination.c_validcombination_id FROM c_validcombination WHERE c_validcombination.c_validcombination_id = (((SELECT sspr_acctledger_1.c_validcombination_id FROM sspr_acctledger sspr_acctledger_1)))))))) = 'Y' THEN to_char('H') ELSE to_char('XXXX') END AS movimiento, CASE WHEN ((SELECT sspr_acctledger.closingaccount FROM sspr_acctledger WHERE sspr_acctledger.c_validcombination_id = (((SELECT c_validcombination.c_validcombination_id FROM c_validcombination WHERE c_validcombination.c_validcombination_id = (((SELECT sspr_acctledger_1.c_validcombination_id FROM sspr_acctledger sspr_acctledger_1)))))))) = 'Y' THEN 0 ELSE 0 END AS debe, CASE WHEN ((SELECT sspr_acctledger.closingaccount FROM sspr_acctledger WHERE sspr_acctledger.c_validcombination_id = (((SELECT c_validcombination.c_validcombination_id FROM c_validcombination WHERE c_validcombination.c_validcombination_id = (((SELECT sspr_acctledger_1.c_validcombination_id FROM sspr_acctledger sspr_acctledger_1)))))))) = 'Y' THEN COALESCE(round(to_number((SELECT sum(round(x.amount, 2)) AS sum FROM sspr_payroll_ticket_concept x LEFT JOIN sspr_payroll_ticket w ON x.sspr_payroll_ticket_id = w.sspr_payroll_ticket_id LEFT JOIN sspr_payroll v ON w.sspr_payroll_id = v.sspr_payroll_id LEFT JOIN sspr_concept y ON x.sspr_concept_id = y.sspr_concept_id LEFT JOIN sspr_concept_acct z ON y.sspr_concept_id = z.sspr_concept_id WHERE z.isexpend = 'Y' AND v.c_period_id = h.c_period_id AND z.sspr_category_acct_id = f.em_sspr_category_acct_id AND v.sspr_payroll_id = d.sspr_payroll_id)), 2), 0) - COALESCE(round(to_number((SELECT sum(round(x.amount, 2)) AS sum FROM sspr_payroll_ticket_concept x LEFT JOIN sspr_payroll_ticket w ON x.sspr_payroll_ticket_id = w.sspr_payroll_ticket_id LEFT JOIN sspr_payroll v ON w.sspr_payroll_id = v.sspr_payroll_id LEFT JOIN sspr_concept y ON x.sspr_concept_id = y.sspr_concept_id LEFT JOIN sspr_concept_acct z ON y.sspr_concept_id = z.sspr_concept_id WHERE (z.isaccountcharge = 'Y' OR z.isliability = 'Y') AND v.c_period_id = h.c_period_id AND z.sspr_category_acct_id = f.em_sspr_category_acct_id AND v.sspr_payroll_id = d.sspr_payroll_id)), 2), 0) ELSE NULL END AS haber, COALESCE(round(to_number((SELECT sum(round(x.amount, 2)) AS sum FROM sspr_payroll_ticket_concept x LEFT JOIN sspr_payroll_ticket w ON x.sspr_payroll_ticket_id = w.sspr_payroll_ticket_id LEFT JOIN sspr_payroll v ON w.sspr_payroll_id = v.sspr_payroll_id LEFT JOIN sspr_concept y ON x.sspr_concept_id = y.sspr_concept_id LEFT JOIN sspr_concept_acct z ON y.sspr_concept_id = z.sspr_concept_id WHERE z.isexpend = 'Y' AND v.c_period_id = h.c_period_id AND z.sspr_category_acct_id = f.em_sspr_category_acct_id AND v.sspr_payroll_id = d.sspr_payroll_id)), 2), 0) - COALESCE(round(to_number((SELECT sum(round(x.amount, 2)) AS sum FROM sspr_payroll_ticket_concept x LEFT JOIN sspr_payroll_ticket w ON x.sspr_payroll_ticket_id = w.sspr_payroll_ticket_id LEFT JOIN sspr_payroll v ON w.sspr_payroll_id = v.sspr_payroll_id LEFT JOIN sspr_concept y ON x.sspr_concept_id = y.sspr_concept_id LEFT JOIN sspr_concept_acct z ON y.sspr_concept_id = z.sspr_concept_id WHERE (z.isaccountcharge = 'Y' OR z.isliability = 'Y') AND v.c_period_id = h.c_period_id AND z.sspr_category_acct_id = f.em_sspr_category_acct_id AND v.sspr_payroll_id = d.sspr_payroll_id)), 2), 0) AS monto, ' - ' || (((SELECT sspr_acctledger.name FROM sspr_acctledger WHERE sspr_acctledger.c_validcombination_id = g.c_validcombination_id))) AS detalle, (SELECT c_period.name FROM c_period WHERE c_period.c_period_id = d.c_period_id) AS periodo, a.sspr_payroll_id AS sspr_rpt_asientonomina_id, a.ad_client_id, a.ad_org_id, now() AS created, a.createdby, now() AS updated, a.updatedby, 'Y' AS isactive FROM sspr_payroll_ticket a LEFT JOIN sspr_payroll_ticket_concept b ON a.sspr_payroll_ticket_id = b.sspr_payroll_ticket_id LEFT JOIN sspr_concept c ON b.sspr_concept_id = c.sspr_concept_id LEFT JOIN sspr_payroll d ON a.sspr_payroll_id = d.sspr_payroll_id LEFT JOIN sspr_concept_acct e ON c.sspr_concept_id = e.sspr_concept_id LEFT JOIN c_bpartner f ON a.c_bpartner_id = f.c_bpartner_id LEFT JOIN c_validcombination g ON e.c_debit_acct = g.c_validcombination_id OR e.c_credit_acct = g.c_validcombination_id LEFT JOIN c_period h ON d.c_period_id = h.c_period_id WHERE e.isaccountcharge IS NOT NULL AND e.isexpend IS NOT NULL AND e.isliability IS NOT NULL AND b.amount <> 0 AND d.ispayroll = 'Y') aa GROUP BY aa.cuenta, aa.tercero, aa.descripcioncuenta, aa.movimiento, aa.debe, aa.haber, aa.monto, aa.detalle, aa.periodo, aa.sspr_rpt_asientonomina_id, aa.ad_client_id, aa.ad_org_id, aa.created, aa.updated, aa.createdby, aa.updatedby, aa.isactive ORDER BY aa.periodo, aa.cuenta, aa.debe]]></view>
  </database>
