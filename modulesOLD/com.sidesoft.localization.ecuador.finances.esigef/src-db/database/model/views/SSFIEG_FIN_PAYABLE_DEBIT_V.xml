<?xml version="1.0"?>
  <database name="VIEW SSFIEG_FIN_PAYABLE_DEBIT_V">
    <view name="SSFIEG_FIN_PAYABLE_DEBIT_V"><![CDATA[(SELECT get_uuid() AS ssfieg_fin_payable_debit_v_id, f.ad_client_id, f.ad_org_id, f.isactive, now() AS created, f.createdby, now() AS updated, f.updatedby, f.dateacct, 'PAGO' AS tipo_transaccion, a.documentno, e.documentno AS description, round(avg(f.amtacctdr), 2) AS monto_debe, round(avg(e.grandtotal), 2) AS grandtotal, substr(l.value, 1, 2) AS tipo_gasto, l.sfb_budget_item_id, sum(g.taxbaseamt) AS base_ret_renta, sum(g.taxamt) AS ret_renta, sum(h.taxbaseamt) AS base_ret_iva, sum(h.taxamt) AS ret_iva, sum(j.taxbaseamt) AS base_iva, sum(j.taxamt) AS iva, sum(j.taxbaseamt + j.taxamt + g.taxamt + h.taxamt) AS valor_final FROM fact_acct f JOIN fin_payment a ON a.fin_payment_id = f.record_id JOIN fin_payment_detail b ON f.line_id = b.fin_payment_detail_id LEFT JOIN fin_payment_scheduledetail c ON b.fin_payment_detail_id = c.fin_payment_detail_id LEFT JOIN fin_payment_schedule d ON c.fin_payment_schedule_invoice = d.fin_payment_schedule_id LEFT JOIN c_invoice e ON d.c_invoice_id = e.c_invoice_id JOIN c_invoiceline ff ON e.c_invoice_id = ff.c_invoice_id LEFT JOIN c_invoicetax g ON ff.em_sswh_invoicetax_income_id = g.c_invoicetax_id LEFT JOIN c_invoicetax h ON ff.em_sswh_invoicetax_vat_id = h.c_invoicetax_id LEFT JOIN c_tax i ON g.c_tax_id = i.c_tax_id LEFT JOIN c_invoicelinetax j ON ff.c_invoiceline_id = j.c_invoiceline_id LEFT JOIN sfb_budget_cert_line k ON ff.em_sfb_budget_cert_line_id = k.sfb_budget_cert_line_id LEFT JOIN sfb_budget_item l ON k.sfb_budget_item_id = l.sfb_budget_item_id WHERE (f.acctvalue IN (SELECT c_validcombination.combination FROM c_validcombination WHERE (c_validcombination.c_validcombination_id IN (SELECT ssfieg_fin_acct_payable.account_id FROM ssfieg_fin_acct_payable)))) AND f.amtacctdr <> 0 GROUP BY f.fact_acct_id, a.documentno, e.documentno, substr(l.value, 1, 2), l.sfb_budget_item_id UNION ALL SELECT get_uuid() AS ssfieg_fin_payable_debit_v_id, f.ad_client_id, f.ad_org_id, f.isactive, now() AS created, f.createdby, now() AS updated, f.updatedby, f.dateacct, 'CONCEPTO CONTABLE' AS tipo_transaccion, a.documentno, g.name AS description, round(avg(f.amtacctdr), 2) AS monto_debe, round(avg(e.grandtotal), 2) AS grandtotal, 'NA' AS tipo_gasto, NULL AS sfb_budget_item_id, 0 AS base_ret_renta, 0 AS ret_renta, 0 AS base_ret_iva, 0 AS ret_iva, 0 AS base_iva, 0 AS iva, round(avg(f.amtacctdr)) AS valor_final FROM fact_acct f JOIN fin_payment a ON a.fin_payment_id = f.record_id JOIN fin_payment_detail b ON f.line_id = b.fin_payment_detail_id LEFT JOIN fin_payment_scheduledetail c ON b.fin_payment_detail_id = c.fin_payment_detail_id LEFT JOIN fin_payment_schedule d ON c.fin_payment_schedule_invoice = d.fin_payment_schedule_id LEFT JOIN c_invoice e ON d.c_invoice_id = e.c_invoice_id LEFT JOIN c_glitem g ON b.c_glitem_id = g.c_glitem_id WHERE e.documentno IS NULL AND (f.acctvalue IN (SELECT c_validcombination.combination FROM c_validcombination WHERE (c_validcombination.c_validcombination_id IN (SELECT ssfieg_fin_acct_payable.account_id FROM ssfieg_fin_acct_payable)))) AND f.amtacctdr <> 0 GROUP BY f.fact_acct_id, a.documentno, g.name) UNION ALL SELECT get_uuid() AS ssfieg_fin_payable_debit_v_id, f.ad_client_id, f.ad_org_id, f.isactive, now() AS created, f.createdby, now() AS updated, f.updatedby, f.dateacct, 'NOTA CREDITO' AS tipo_transaccion, 'N/A' AS documentno, e.documentno AS description, round(avg(f.amtacctdr), 2) AS monto_debe, round(avg(e.grandtotal), 2) AS grandtotal, COALESCE(substr(l.value, 1, 2), 'N/A') AS tipo_gasto, l.sfb_budget_item_id, sum(g.taxbaseamt) AS base_ret_renta, sum(g.taxamt) AS ret_renta, sum(h.taxbaseamt) AS base_ret_iva, sum(h.taxamt) AS ret_iva, sum(j.taxbaseamt) AS base_iva, sum(j.taxamt) AS iva, sum(j.taxbaseamt + j.taxamt + g.taxamt + h.taxamt) AS valor_final FROM fact_acct f LEFT JOIN c_invoice e ON f.record_id = e.c_invoice_id JOIN c_invoiceline ff ON e.c_invoice_id = ff.c_invoice_id LEFT JOIN c_invoicetax g ON ff.em_sswh_invoicetax_income_id = g.c_invoicetax_id LEFT JOIN c_invoicetax h ON ff.em_sswh_invoicetax_vat_id = h.c_invoicetax_id LEFT JOIN c_tax i ON g.c_tax_id = i.c_tax_id JOIN c_invoicelinetax j ON ff.c_invoiceline_id = j.c_invoiceline_id LEFT JOIN sfb_budget_cert_line k ON ff.em_sfb_budget_cert_line_id = k.sfb_budget_cert_line_id JOIN sfb_budget_item l ON k.sfb_budget_item_id = l.sfb_budget_item_id WHERE (f.acctvalue IN (SELECT c_validcombination.combination FROM c_validcombination WHERE (c_validcombination.c_validcombination_id IN (SELECT ssfieg_fin_acct_payable.account_id FROM ssfieg_fin_acct_payable)))) AND f.amtacctdr <> 0 GROUP BY f.fact_acct_id, e.documentno, COALESCE(substr(l.value, 1, 2), 'N/A'), l.sfb_budget_item_id ORDER BY 2]]></view>
  </database>
