<?xml version="1.0"?>
  <database name="VIEW SSFIEG_FIN_RECE_DEBIT_V">
    <view name="SSFIEG_FIN_RECE_DEBIT_V"><![CDATA[(SELECT get_uuid() AS ssfieg_fin_rece_debit_v_id, f.ad_client_id, f.ad_org_id, f.isactive, now() AS created, f.createdby, now() AS updated, f.updatedby, f.dateacct, 'COBRO' AS tipo_transaccion, a.documentno, e.documentno AS description, round(avg(f.amtacctdr), 2) AS monto_debe, round(avg(e.grandtotal), 2) AS grandtotal, substr(sfb.value, 1, 2) AS tipo_ingreso, sum(j.taxbaseamt) AS base_iva, sum(j.taxamt) AS iva, sum(j.taxbaseamt + j.taxamt) AS valor_final FROM fact_acct f JOIN fin_payment a ON a.fin_payment_id = f.record_id JOIN fin_payment_detail b ON f.line_id = b.fin_payment_detail_id LEFT JOIN fin_payment_scheduledetail c ON b.fin_payment_detail_id = c.fin_payment_detail_id LEFT JOIN fin_payment_schedule d ON c.fin_payment_schedule_invoice = d.fin_payment_schedule_id LEFT JOIN c_invoice e ON d.c_invoice_id = e.c_invoice_id JOIN c_invoiceline ff ON e.c_invoice_id = ff.c_invoice_id JOIN c_invoicelinetax j ON ff.c_invoiceline_id = j.c_invoiceline_id JOIN m_product p ON ff.m_product_id = p.m_product_id JOIN m_product_acct pa ON p.m_product_id = pa.m_product_id JOIN c_validcombination cvc ON pa.p_revenue_acct = cvc.c_validcombination_id JOIN sfb_budget_item_account sfbi ON cvc.account_id = sfbi.account_id JOIN sfb_budget_item sfb ON sfbi.sfb_budget_item_id = sfb.sfb_budget_item_id WHERE (f.acctvalue IN (SELECT c_validcombination.combination FROM c_validcombination WHERE (c_validcombination.c_validcombination_id IN (SELECT ssfieg_fin_acct_receivable.account_id FROM ssfieg_fin_acct_receivable)))) AND f.amtacctdr <> 0 GROUP BY f.fact_acct_id, a.documentno, e.documentno, substr(sfb.value, 1, 2) UNION ALL SELECT get_uuid() AS ssfieg_fin_rece_debit_v_id, f.ad_client_id, f.ad_org_id, f.isactive, now() AS created, f.createdby, now() AS updated, f.updatedby, f.dateacct, 'ASIENTO CONTABLE' AS tipo_transaccion, gl.documentno, gl.documentno AS description, round(f.amtacctdr, 2) AS monto_debe, 0 AS grandtotal, 'NA' AS tipo_ingreso, 0 AS base_iva, 0 AS iva, 0 AS valor_final FROM fact_acct f JOIN gl_journal gl ON f.record_id = gl.gl_journal_id WHERE (f.acctvalue IN (SELECT c_validcombination.combination FROM c_validcombination WHERE (c_validcombination.c_validcombination_id IN (SELECT ssfieg_fin_acct_receivable.account_id FROM ssfieg_fin_acct_receivable)))) AND f.amtacctdr <> 0 AND f.docbasetype = 'GLJ') UNION ALL SELECT get_uuid() AS ssfieg_fin_rece_debit_v_id, f.ad_client_id, f.ad_org_id, f.isactive, now() AS created, f.createdby, now() AS updated, f.updatedby, f.dateacct, 'FACTURA' AS tipo_transaccion, e.documentno, e.documentno AS description, round(avg(f.amtacctdr), 2) AS monto_debe, round(avg(e.grandtotal), 2) AS grandtotal, substr(sfb.value, 1, 2) AS tipo_ingreso, sum(j.taxbaseamt) AS base_iva, sum(j.taxamt) AS iva, sum(j.taxbaseamt + j.taxamt) AS valor_final FROM fact_acct f LEFT JOIN c_invoice e ON f.record_id = e.c_invoice_id JOIN c_invoiceline ff ON e.c_invoice_id = ff.c_invoice_id JOIN c_invoicelinetax j ON ff.c_invoiceline_id = j.c_invoiceline_id JOIN m_product p ON ff.m_product_id = p.m_product_id JOIN m_product_acct pa ON p.m_product_id = pa.m_product_id JOIN c_validcombination cvc ON pa.p_revenue_acct = cvc.c_validcombination_id JOIN sfb_budget_item_account sfbi ON cvc.account_id = sfbi.account_id JOIN sfb_budget_item sfb ON sfbi.sfb_budget_item_id = sfb.sfb_budget_item_id WHERE (f.acctvalue IN (SELECT c_validcombination.combination FROM c_validcombination WHERE (c_validcombination.c_validcombination_id IN (SELECT ssfieg_fin_acct_receivable.account_id FROM ssfieg_fin_acct_receivable)))) AND f.amtacctdr <> 0 GROUP BY f.fact_acct_id, e.documentno, substr(sfb.value, 1, 2) ORDER BY 2, 3]]></view>
  </database>
