<?xml version="1.0"?>
  <database name="VIEW SSFI_ADVANCEDPAYMENT_V">
    <view name="SSFI_ADVANCEDPAYMENT_V"><![CDATA[SELECT fpd.fin_payment_id, fp.documentno AS documento, fp.referenceno AS referencia, fp.paymentdate AS fecha_cp, fp.paymentdate AS fecha_contable, fp.isreceipt AS tipo_transaccion, fpd.amount AS pago_cobro, fp.c_costcenter_id AS costcenter_id, fp.user1_id, fp.status AS estado, fp.generated_credit AS credito_generado, fp.used_credit AS credito_usado, fpd.c_glitem_id, fpsd.fin_payment_schedule_invoice, fp.status, fp.c_doctype_id, fp.c_bpartner_id, fp.description AS concepto, fp.posted FROM fin_payment_detail fpd JOIN fin_payment_scheduledetail fpsd ON fpd.fin_payment_detail_id = fpsd.fin_payment_detail_id JOIN fin_payment fp ON fp.fin_payment_id = fpd.fin_payment_id WHERE fpd.isprepayment = 'Y' AND fpd.c_glitem_id IS NULL AND fpsd.fin_payment_schedule_invoice IS NULL UNION ALL SELECT fp.fin_payment_id, fp.documentno AS documento, fp.referenceno AS referencia, fp.paymentdate AS fecha_cp, fp.paymentdate AS fecha_contable, fp.isreceipt AS tipo_transaccion, CASE WHEN fp.generated_credit = 0 AND fp.used_credit > 0 THEN fp.used_credit WHEN fp.generated_credit > 0 THEN fp.generated_credit ELSE fp.amount END AS pago_cobro, fp.c_costcenter_id AS costcenter_id, fp.user1_id, fp.status AS estado, fp.generated_credit AS credito_generado, fp.used_credit AS credito_usado, '' AS c_glitem_id, '' AS fin_payment_schedule_invoice, fp.status, fp.c_doctype_id, fp.c_bpartner_id, fp.description AS concepto, fp.posted FROM fin_payment fp WHERE (fp.fin_payment_id IN (SELECT fin_payment_credit.fin_payment_id FROM fin_payment_credit)) AND NOT (fp.fin_payment_id IN (SELECT fpd.fin_payment_id FROM fin_payment_detail fpd JOIN fin_payment_scheduledetail fpsd ON fpd.fin_payment_detail_id = fpsd.fin_payment_detail_id JOIN fin_payment fp_1 ON fp_1.fin_payment_id = fpd.fin_payment_id WHERE fpd.isprepayment = 'Y'))]]></view>
  </database>
