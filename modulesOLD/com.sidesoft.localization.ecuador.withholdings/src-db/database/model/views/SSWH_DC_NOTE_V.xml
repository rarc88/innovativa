<?xml version="1.0"?>
  <database name="VIEW SSWH_DC_NOTE_V">
    <view name="SSWH_DC_NOTE_V"><![CDATA[SELECT ci.c_invoice_id, to_char(slh.value) AS tipo_comprobante, substr(sescr_returndocumentno(ci_dn.poreference), 1, 3) AS establecimiento, substr(sescr_returndocumentno(ci_dn.poreference), 5, 3) AS caja, lpad(substr(sescr_returndocumentno(ci_dn.poreference), 9, 9), 9, '0') AS secuencia, COALESCE(ci_dn.em_sswh_nroauthorization, '') AS autorizacion FROM c_invoice ci LEFT JOIN sswh_livelihoodt slhc ON slhc.sswh_livelihoodt_id = ci.em_sswh_livelihood LEFT JOIN c_invoice ci_dn ON ci_dn.c_invoice_id = ci.em_scnr_invoice_id LEFT JOIN sswh_livelihoodt slh ON slh.sswh_livelihoodt_id = ci_dn.em_sswh_livelihood WHERE slhc.value = '04' AND ci.em_scnr_isref_inv = 'Y' AND ci.em_scnr_invoice_id IS NOT NULL AND ci.issotrx = 'N' UNION ALL SELECT ci.c_invoice_id, to_char(slh.value) AS tipo_comprobante, substr(sescr_returndocumentno(ci_dn.poreference), 1, 3) AS establecimiento, substr(sescr_returndocumentno(ci_dn.poreference), 5, 3) AS caja, lpad(substr(sescr_returndocumentno(ci_dn.poreference), 9, 9), 9, '0') AS secuencia, COALESCE(ci_dn.em_sswh_nroauthorization, sat.authorizationno) AS autorizacion FROM c_invoice ci LEFT JOIN sswh_livelihoodt slhc ON slhc.sswh_livelihoodt_id = ci.em_sswh_livelihood LEFT JOIN c_invoice ci_dn ON ci_dn.c_invoice_id = ci.em_scnr_invoice_id LEFT JOIN sswh_livelihoodt slh ON slh.sswh_livelihoodt_id = ci_dn.em_sswh_livelihood LEFT JOIN sswh_authorization sat ON sat.c_doctype_id = ci_dn.c_doctype_id WHERE slhc.value = '05' AND ci.em_scnr_isref_inv = 'Y' AND ci.em_scnr_invoice_id IS NOT NULL AND ci.issotrx = 'N']]></view>
  </database>
