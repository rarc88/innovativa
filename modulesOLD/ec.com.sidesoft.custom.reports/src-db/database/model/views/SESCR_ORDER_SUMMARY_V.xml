<?xml version="1.0"?>
  <database name="VIEW SESCR_ORDER_SUMMARY_V">
    <view name="SESCR_ORDER_SUMMARY_V"><![CDATA[SELECT get_uuid() AS sescr_order_summary_v_id, impuesto.ad_client_id, impuesto.ad_org_id, impuesto.isactive, impuesto.created, impuesto.createdby, impuesto.updated, impuesto.updatedby, impuesto.c_order_id, sum(impuesto.importe_bruto) AS importe_bruto, sum(impuesto.importe_imponible) AS importe_imponible, sum(impuesto.impuesto) AS impuesto, sum(impuesto.basecero) AS basecero, sum(impuesto.base12) AS base12, sum(impuesto.iva) AS iva12 FROM (SELECT co.c_order_id, co.ad_client_id, co.ad_org_id, co.isactive, co.created, co.createdby, co.updated, co.updatedby, sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate = 0 THEN colt.taxbaseamt WHEN ct.istaxdeductable = 'Y' AND ct.rate <> 0 THEN colt.taxbaseamt ELSE NULL END) + sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate <> 0 THEN colt.taxamt ELSE 0 END) AS importe_bruto, sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate = 0 THEN colt.taxbaseamt ELSE 0 END + CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate <> 0 THEN colt.taxbaseamt ELSE 0 END + CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate = 0 THEN colt.taxamt ELSE 0 END) AS importe_imponible, sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate <> 0 THEN colt.taxamt ELSE 0 END) AS impuesto, sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate = 0 THEN colt.taxbaseamt ELSE 0 END) AS basecero, sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate <> 0 THEN colt.taxbaseamt ELSE 0 END) AS base12, sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate <> 0 THEN colt.taxamt ELSE 0 END) AS iva FROM c_order co JOIN c_orderline col ON col.c_order_id = co.c_order_id JOIN m_product mp ON mp.m_product_id = col.m_product_id JOIN c_orderlinetax colt ON colt.c_order_id = co.c_order_id AND col.c_orderline_id = colt.c_orderline_id JOIN c_tax ct ON ct.c_tax_id = colt.c_tax_id GROUP BY co.c_order_id, co.ad_client_id, co.ad_org_id, co.isactive, co.created, co.createdby, co.updated, co.updatedby) impuesto GROUP BY impuesto.c_order_id, impuesto.ad_client_id, impuesto.ad_org_id, impuesto.isactive, impuesto.created, impuesto.createdby, impuesto.updated, impuesto.updatedby]]></view>
  </database>
