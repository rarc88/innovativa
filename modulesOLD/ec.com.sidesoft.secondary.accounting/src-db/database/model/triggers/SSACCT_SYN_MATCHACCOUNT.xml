<?xml version="1.0"?>
  <database name="TRIGGER SSACCT_SYN_MATCHACCOUNT">
    <trigger name="SSACCT_SYN_MATCHACCOUNT" table="FACT_ACCT" fires="after" insert="true" update="false" delete="true" foreach="row">
      <body><![CDATA[  v_ACCOUNT_ID_DEPENDENT  VARCHAR(32);
  v_VALUE_ACCOUNT VARCHAR(40);

BEGIN
  
  IF AD_isTriggerEnabled()='N' THEN RETURN;
  END IF;
    
  IF (INSERTING) THEN 
  
     SELECT ACCOUNT_ID_DEPENDENT, EV.VALUE
	 INTO v_ACCOUNT_ID_DEPENDENT, v_VALUE_ACCOUNT 
	 FROM SSACCT_MATCH_ACCOUNTS MA INNER JOIN  C_ELEMENTVALUE EV ON MA.ACCOUNT_ID_DEPENDENT = EV.C_ELEMENTVALUE_ID 
	 WHERE ACCOUNT_ID_MAIN = :NEW.ACCOUNT_ID;
	 
	 INSERT INTO PUBLIC.ssacct_factacctsecondary(
	ssacct_factacctsecondary_id, AD_CLIENT_ID, AD_ORG_ID, ISACTIVE, CREATED, 
	CREATEDBY, UPDATED, UPDATEDBY, C_ACCTSCHEMA_ID, ACCOUNT_ID, 
	DATETRX, DATEACCT, C_PERIOD_ID, AD_TABLE_ID, RECORD_ID, 
	LINE_ID, GL_CATEGORY_ID, C_TAX_ID, M_LOCATOR_ID, POSTINGTYPE, 
	C_CURRENCY_ID,	AMTSOURCEDR, AMTSOURCECR, AMTACCTDR, AMTACCTCR, C_UOM_ID, QTY, M_PRODUCT_ID, C_BPARTNER_ID, 
	AD_ORGTRX_ID, C_LOCFROM_ID, C_LOCTO_ID, C_SALESREGION_ID, C_PROJECT_ID, C_CAMPAIGN_ID, 
	C_ACTIVITY_ID, USER1_ID, USER2_ID, DESCRIPTION, A_ASSET_ID, FACT_ACCT_GROUP_ID, SEQNO, 
	FACTACCTTYPE, DOCBASETYPE, ACCTVALUE, ACCTDESCRIPTION, RECORD_ID2, C_WITHHOLDING_ID, 
	C_DOCTYPE_ID, C_COSTCENTER_ID, ISMODIFY, DATEBALANCED)
	VALUES (:NEW.FACT_ACCT_ID, :NEW.AD_CLIENT_ID, :NEW.AD_ORG_ID, :NEW.ISACTIVE, :NEW.CREATED, :NEW.CREATEDBY, :NEW.UPDATED, :NEW.UPDATEDBY, :NEW.C_ACCTSCHEMA_ID, 
	v_ACCOUNT_ID_DEPENDENT, :NEW.DATETRX, :NEW.DATEACCT, :NEW.C_PERIOD_ID,  :NEW.AD_TABLE_ID, :NEW.RECORD_ID, :NEW.LINE_ID, 
	:NEW.GL_CATEGORY_ID, :NEW.C_TAX_ID, :NEW.M_LOCATOR_ID, :NEW.POSTINGTYPE, :NEW.C_CURRENCY_ID, :NEW.AMTSOURCEDR,:NEW.AMTSOURCECR, 
	:NEW.AMTACCTDR, :NEW.AMTACCTCR,:NEW.C_UOM_ID,:NEW.QTY,:NEW.M_PRODUCT_ID, :NEW.C_BPARTNER_ID, :NEW.AD_ORGTRX_ID, :NEW.C_LOCFROM_ID, :NEW.C_LOCTO_ID, 
	:NEW.C_SALESREGION_ID,:NEW.C_PROJECT_ID, :NEW.C_CAMPAIGN_ID,
	:NEW.C_ACTIVITY_ID, :NEW.USER1_ID, :NEW.USER2_ID, :NEW.DESCRIPTION, :NEW.A_ASSET_ID, :NEW.FACT_ACCT_GROUP_ID, :NEW.SEQNO, :NEW.FACTACCTTYPE, :NEW.DOCBASETYPE, 
	v_VALUE_ACCOUNT, :NEW.ACCTDESCRIPTION, :NEW.RECORD_ID2, :NEW.C_WITHHOLDING_ID, :NEW.C_DOCTYPE_ID, :NEW.C_COSTCENTER_ID, :NEW.ISMODIFY, :NEW.DATEBALANCED);

  END IF;
  
  
  IF(DELETING) THEN
    SELECT ACCOUNT_ID_DEPENDENT INTO v_ACCOUNT_ID_DEPENDENT FROM SSACCT_MATCH_ACCOUNTS WHERE ACCOUNT_ID_MAIN = :OLD.ACCOUNT_ID;
    IF (v_ACCOUNT_ID_DEPENDENT IS NOT NULL) THEN
	  DELETE FROM ssacct_factacctsecondary facs WHERE :OLD.RECORD_ID = facs.RECORD_ID AND :OLD.AD_TABLE_ID = facs.AD_TABLE_ID AND facs.ACCOUNT_ID = v_ACCOUNT_ID_DEPENDENT;
	END IF;
  END IF;
  
   END SSACCT_SYN_MATCHACCOUNT
]]></body>
    </trigger>
  </database>
