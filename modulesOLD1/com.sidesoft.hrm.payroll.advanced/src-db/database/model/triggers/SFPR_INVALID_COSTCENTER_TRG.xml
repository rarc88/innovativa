<?xml version="1.0"?>
  <database name="TRIGGER SFPR_INVALID_COSTCENTER_TRG">
    <trigger name="SFPR_INVALID_COSTCENTER_TRG" table="SFPR_EMPLOYEE_SITUATION" fires="before" insert="true" update="true" delete="false" foreach="row">
      <body><![CDATA[
   V_CONTRACT_ID VARCHAR2(32); 	--OBTG:VARCHAR2--
   V_COSTCENTER_ID VARCHAR2(32); --OBTG:VARCHAR2--
   V_COUNT NUMBER;		--OBTG:NUMBER--
   

 
BEGIN
    
    
  IF AD_isTriggerEnabled()='N' THEN RETURN;
  END IF; 

  IF (INSERTING OR UPDATING) THEN

	V_CONTRACT_ID:= :NEW.EM_SSPR_CONTRACT_ID;
	V_COSTCENTER_ID:= :NEW.C_COSTCENTER_ID;
	
	IF V_CONTRACT_ID IS NOT NULL THEN

		SELECT COUNT(*)
		INTO V_COUNT
		FROM C_BPARTNER BP
		LEFT JOIN SSPR_CONTRACT C ON C.C_BPARTNER_ID = BP.C_BPARTNER_ID
		LEFT JOIN SFPR_EMPLOYEE_SITUATION ES ON ES.EM_SSPR_CONTRACT_ID = C.SSPR_CONTRACT_ID
		WHERE C.SSPR_CONTRACT_ID = V_CONTRACT_ID AND BP.EM_SSPR_COSTCENTER_ID = V_COSTCENTER_ID;

		IF V_COUNT = 0 THEN
			RAISE_APPLICATION_ERROR(-20000, '@sfpr_validate_costcenter@');
		END IF;
		
	END IF;	
	 	
  END IF;
  

  END SFPR_INVALID_COSTCENTER_TRG
]]></body>
    </trigger>
  </database>
