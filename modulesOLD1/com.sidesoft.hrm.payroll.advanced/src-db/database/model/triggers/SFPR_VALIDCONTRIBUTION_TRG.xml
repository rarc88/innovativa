<?xml version="1.0"?>
  <database name="TRIGGER SFPR_VALIDCONTRIBUTION_TRG">
    <trigger name="SFPR_VALIDCONTRIBUTION_TRG" table="SFPR_EMPLOYEE_CONTRIBUTION" fires="before" insert="true" update="true" delete="false" foreach="row">
      <body><![CDATA[
   V_CONTRIBUTION_ID VARCHAR(32); 	--OBTG:VARCHAR2--
   V_CONCEPT_PERSONAL VARCHAR(32); 	--OBTG:VARCHAR2--
   V_AMOUNT_PERSONAL NUMBER;		--OBTG:NUMBER--
   V_CONCEPT_BOSSES VARCHAR(32); 	--OBTG:VARCHAR2--
   V_AMOUNT_BOSSES NUMBER;		--OBTG:NUMBER--
   
BEGIN
    
    
   IF AD_isTriggerEnabled()='N' THEN RETURN;
  END IF; 

  IF (INSERTING OR UPDATING) THEN

	V_CONTRIBUTION_ID:= :NEW.sfpr_employee_contribution_id;
	V_CONCEPT_PERSONAL:= :NEW.personal_concept;
	V_AMOUNT_PERSONAL:= :NEW.porc_personal;
	V_CONCEPT_BOSSES:= :NEW.concept_bosses;
	V_AMOUNT_BOSSES:= :NEW.porc_bosses;
	

		IF ((V_CONCEPT_PERSONAL IS  NULL AND  (COALESCE(TO_CHAR(V_AMOUNT_PERSONAL),'0') = '0')) AND (V_CONCEPT_BOSSES IS NULL AND (COALESCE(TO_CHAR(V_AMOUNT_BOSSES),'0') = '0') )) THEN

			RAISE_APPLICATION_ERROR(-20000, '@SFPR_INVALID_CONTRIBUTION@');

		ELSIF ((V_CONCEPT_PERSONAL IS NOT NULL) AND (V_CONCEPT_BOSSES IS NOT NULL) 
		AND (COALESCE(TO_CHAR(V_AMOUNT_PERSONAL),'0') <> '0' OR COALESCE(TO_CHAR(V_AMOUNT_BOSSES),'0') <> '0')
		) THEN

			RAISE_APPLICATION_ERROR(-20000, '@SFPR_INVALID_CONTRIBUTION@');
			
		
		ELSIF ((V_CONCEPT_PERSONAL IS NOT NULL AND V_CONCEPT_BOSSES IS NULL)) THEN

			IF (COALESCE(TO_CHAR(V_AMOUNT_PERSONAL),'0') = '0'  AND  (COALESCE(TO_CHAR(V_AMOUNT_BOSSES),'0') = '0' OR COALESCE(TO_CHAR(V_AMOUNT_BOSSES),'0') <> '0' )) THEN

				RAISE_APPLICATION_ERROR(-20000, '@SFPR_INVALIDCONTRIBUTIONPERSONAL@');
				
			END IF;

		ELSIF  ((V_CONCEPT_BOSSES IS NOT NULL) AND (V_CONCEPT_PERSONAL IS NULL)) THEN

			IF (COALESCE(TO_CHAR(V_AMOUNT_BOSSES),'0') = '0'  AND  (COALESCE(TO_CHAR(V_AMOUNT_PERSONAL),'0') = '0' OR COALESCE(TO_CHAR(V_AMOUNT_PERSONAL),'0') <> '0' ))  THEN

				RAISE_APPLICATION_ERROR(-20000, '@SFPR_INVALIDCONTRIBUTIONBOSSES@');
			ELSIF (COALESCE(TO_CHAR(V_AMOUNT_BOSSES),'0') <> '0'  AND  ( COALESCE(TO_CHAR(V_AMOUNT_PERSONAL),'0') <> '0' ))  THEN

				RAISE_APPLICATION_ERROR(-20000, '@SFPR_INVALIDCONTRIBUTIONBOSSES@');
				
			END IF;

		END IF;

	 	
  END IF;
  

  END SFPR_VALIDCONTRIBUTION_TRG
]]></body>
    </trigger>
  </database>
