<?xml version="1.0"?>
  <database name="VIEW SSFI_BASES_V">
    <view name="SSFI_BASES_V"><![CDATA[SELECT get_uuid() AS ssfi_bases_v_id, impuesto.ad_client_id, impuesto.ad_org_id, impuesto.isactive, impuesto.created, impuesto.createdby, impuesto.updated, impuesto.updatedby, impuesto.c_invoice_id, sum(impuesto.basecero) AS basecero, sum(impuesto.base12) AS base12, sum(impuesto.base_excento) AS base_excento, sum(impuesto.base_no_iva) AS base_no_iva FROM (SELECT ci.c_invoice_id, ci.ad_client_id, ci.ad_org_id, ci.isactive, ci.created, ci.createdby, ci.updated, ci.updatedby, sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate = 0 AND ct.em_sswh_isexempt = 'N' AND ct.em_sswh_isnoobjectvat = 'N' THEN cilt.taxbaseamt ELSE 0 END) AS basecero, sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.rate <> 0 AND ct.em_sswh_isexempt = 'N' AND ct.em_sswh_isnoobjectvat = 'N' THEN cilt.taxbaseamt ELSE 0 END) AS base12, sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.em_sswh_isexempt = 'Y' THEN cilt.taxbaseamt ELSE 0 END) AS base_excento, sum(CASE WHEN ct.istaxdeductable = 'Y' AND ct.em_sswh_isnoobjectvat = 'Y' THEN cilt.taxbaseamt ELSE 0 END) AS base_no_iva FROM c_invoice ci JOIN c_invoiceline cil ON cil.c_invoice_id = ci.c_invoice_id JOIN m_product mp ON mp.m_product_id = cil.m_product_id JOIN c_invoicelinetax cilt ON cilt.c_invoice_id = ci.c_invoice_id AND cil.c_invoiceline_id = cilt.c_invoiceline_id JOIN c_tax ct ON ct.c_tax_id = cilt.c_tax_id GROUP BY ci.c_invoice_id, ci.ad_client_id, ci.ad_org_id, ci.isactive, ci.created, ci.createdby, ci.updated, ci.updatedby) impuesto GROUP BY impuesto.c_invoice_id, impuesto.ad_client_id, impuesto.ad_org_id, impuesto.isactive, impuesto.created, impuesto.createdby, impuesto.updated, impuesto.updatedby]]></view>
  </database>
