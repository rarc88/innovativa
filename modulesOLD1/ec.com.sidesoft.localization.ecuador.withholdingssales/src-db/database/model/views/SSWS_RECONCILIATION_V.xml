<?xml version="1.0"?>
  <database name="VIEW SSWS_RECONCILIATION_V">
    <view name="SSWS_RECONCILIATION_V"><![CDATA[SELECT a.fin_financial_account_id, d.dateacct, b.dateto, a.name, a.genericaccountno, (CASE WHEN to_char(g.startdate, 'mm') = '01' THEN 'ENERO' WHEN to_char(g.startdate, 'mm') = '02' THEN 'FEBRERO' WHEN to_char(g.startdate, 'mm') = '03' THEN 'MARZO' WHEN to_char(g.startdate, 'mm') = '04' THEN 'ABRIL' WHEN to_char(g.startdate, 'mm') = '05' THEN 'MAYO' WHEN to_char(g.startdate, 'mm') = '06' THEN 'JUNIO' WHEN to_char(g.startdate, 'mm') = '07' THEN 'JULIO' WHEN to_char(g.startdate, 'mm') = '08' THEN 'AGOSTO' WHEN to_char(g.startdate, 'mm') = '09' THEN 'SEPTIEMBRE' WHEN to_char(g.startdate, 'mm') = '10' THEN 'OCTUBRE' WHEN to_char(g.startdate, 'mm') = '11' THEN 'NOVIEMBRE' WHEN to_char(g.startdate, 'mm') = '12' THEN 'DICIEMBRE' ELSE NULL END || ' DEL ') || to_char(g.startdate, 'yyyy') AS mes_anio, d.dateacct AS dia, e.referenceno AS dcto_y_nro, e.documentno AS cte_ing_egr, e.description AS concepto, f.name AS beneficiario, d.depositamt AS ingresos, d.paymentamt AS egreros, CASE WHEN d.status = 'RPPC' THEN 'CONCILIADO' ELSE NULL END AS estado, 0 AS dep_no_conciliado, 0 AS chq_no_conciliado, b.startingbalance, COALESCE(sum(x.saldo_inicial), 0) + a.initialbalance AS saldo_inicial, g.c_period_id, g.c_year_id, g.startdate AS fecha_desde, g.enddate AS fecha_hasta, a.initialbalance, d.description, d.fin_finacc_transaction_id FROM fin_financial_account a LEFT JOIN fin_reconciliation b ON a.fin_financial_account_id = b.fin_financial_account_id LEFT JOIN fin_finacc_transaction d ON b.fin_reconciliation_id = d.fin_reconciliation_id LEFT JOIN fin_payment e ON d.fin_payment_id = e.fin_payment_id LEFT JOIN c_bpartner f ON e.c_bpartner_id = f.c_bpartner_id LEFT JOIN (SELECT pe.periodno, ye.year, pe.c_period_id, ye.c_year_id, pe.startdate, pe.enddate FROM c_period pe LEFT JOIN c_year ye ON pe.c_year_id = ye.c_year_id) g ON g.periodno = to_number(to_char(b.dateto, 'mm')) AND to_number(g.year) = to_number(to_char(b.dateto, 'yyyy')) LEFT JOIN (SELECT sum(fin_finacc_transaction.depositamt) - sum(fin_finacc_transaction.paymentamt) AS saldo_inicial, fin_finacc_transaction.fin_financial_account_id, fin_finacc_transaction.dateacct, fin_finacc_transaction.fin_reconciliation_id FROM fin_finacc_transaction WHERE fin_finacc_transaction.status = 'RPPC' GROUP BY fin_finacc_transaction.fin_financial_account_id, fin_finacc_transaction.dateacct, fin_finacc_transaction.fin_reconciliation_id) x ON x.fin_financial_account_id = a.fin_financial_account_id AND x.dateacct < g.startdate AND x.fin_reconciliation_id <> d.fin_reconciliation_id WHERE d.status = 'RPPC' GROUP BY a.fin_financial_account_id, a.name, a.genericaccountno, d.dateacct, e.referenceno, e.documentno, e.description, f.name, d.depositamt, d.paymentamt, d.status, b.startingbalance, b.dateto, g.c_period_id, g.c_year_id, g.startdate, g.enddate, a.initialbalance, d.description, d.fin_finacc_transaction_id UNION ALL SELECT g.fin_financial_account_id, d.dateacct, d.dateacct AS dateto, g.name, g.genericaccountno, (CASE WHEN to_char(a.startdate, 'mm') = '01' THEN 'ENERO' WHEN to_char(a.startdate, 'mm') = '02' THEN 'FEBRERO' WHEN to_char(a.startdate, 'mm') = '03' THEN 'MARZO' WHEN to_char(a.startdate, 'mm') = '04' THEN 'ABRIL' WHEN to_char(a.startdate, 'mm') = '05' THEN 'MAYO' WHEN to_char(a.startdate, 'mm') = '06' THEN 'JUNIO' WHEN to_char(a.startdate, 'mm') = '07' THEN 'JULIO' WHEN to_char(a.startdate, 'mm') = '08' THEN 'AGOSTO' WHEN to_char(a.startdate, 'mm') = '09' THEN 'SEPTIEMBRE' WHEN to_char(a.startdate, 'mm') = '10' THEN 'OCTUBRE' WHEN to_char(a.startdate, 'mm') = '11' THEN 'NOVIEMBRE' WHEN to_char(a.startdate, 'mm') = '12' THEN 'DICIEMBRE' ELSE NULL END || ' DEL ') || to_char(a.startdate, 'yyyy') AS mes_anio, e.paymentdate AS dia, e.referenceno AS dcto_y_nro, e.documentno AS cte_ing_egr, e.description AS concepto, f.name AS beneficiario, 0 AS ingresos, 0 AS egreros, CASE WHEN d.status = 'PWNC' THEN 'PAGO NO CONCILIADO' WHEN d.status = 'RDNC' THEN 'COBRO NO CONCILIADO' ELSE NULL END AS estado, d.depositamt AS dep_no_conciliado, d.paymentamt AS chq_no_conciliado, NULL AS startingbalance, COALESCE(sum(x.saldo_inicial), 0) + g.initialbalance AS saldo_inicial, a.c_period_id, a.c_year_id, a.startdate AS fecha_desde, a.enddate AS fecha_hasta, g.initialbalance, d.description, d.fin_finacc_transaction_id FROM fin_financial_account g LEFT JOIN fin_reconciliation b ON g.fin_financial_account_id = b.fin_financial_account_id LEFT JOIN fin_finacc_transaction d ON d.fin_financial_account_id = g.fin_financial_account_id LEFT JOIN fin_payment e ON d.fin_payment_id = e.fin_payment_id LEFT JOIN c_bpartner f ON e.c_bpartner_id = f.c_bpartner_id LEFT JOIN (SELECT pe.periodno, ye.year, pe.c_period_id, ye.c_year_id, pe.startdate, pe.enddate FROM c_period pe LEFT JOIN c_year ye ON pe.c_year_id = ye.c_year_id) a ON a.periodno = to_number(to_char(d.dateacct, 'mm')) AND to_number(a.year) = to_number(to_char(d.dateacct, 'yyyy')) LEFT JOIN (SELECT sum(fin_finacc_transaction.depositamt) - sum(fin_finacc_transaction.paymentamt) AS saldo_inicial, fin_finacc_transaction.fin_financial_account_id, fin_finacc_transaction.dateacct, fin_finacc_transaction.fin_reconciliation_id FROM fin_finacc_transaction WHERE fin_finacc_transaction.status = 'RPPC' GROUP BY fin_finacc_transaction.fin_financial_account_id, fin_finacc_transaction.dateacct, fin_finacc_transaction.fin_reconciliation_id) x ON x.fin_financial_account_id = g.fin_financial_account_id AND x.dateacct < a.startdate AND x.fin_reconciliation_id <> b.fin_reconciliation_id WHERE d.status <> 'RPPC' GROUP BY g.fin_financial_account_id, d.dateacct, g.name, g.genericaccountno, e.paymentdate, e.referenceno, e.documentno, e.description, f.name, d.status, d.depositamt, d.paymentamt, g.initialbalance, a.c_period_id, a.c_year_id, a.startdate, a.enddate, d.description, d.fin_finacc_transaction_id]]></view>
  </database>
