<?xml version="1.0"?>
  <database name="FUNCTION EEI_GET_EXISTRESUPLY">
    <function name="EEI_GET_EXISTRESUPLY" type="VARCHAR">
      <parameter name="p_identifier" type="VARCHAR" mode="in">
        <default/>
      </parameter>
      <parameter name="p_code_to_return" type="VARCHAR" mode="in">
        <default/>
      </parameter>
      <body><![CDATA[v_Module NUMBER:=0;  --OBTG:NUMBER--

    v_Sql VARCHAR2(32767):=NULL; --OBTG:VARCHAR2--
    v_Result VARCHAR2(32767):=NULL;

  BEGIN
	SELECT 
	COALESCE((SELECT COUNT(*) AS CONTAR FROM AD_MODULE WHERE JAVAPACKAGE = 'ec.com.sidesoft.localization.ecuador.resupply'),0)
	INTO v_Module
	FROM DUAL;
	
	IF (v_Module>0) THEN



	IF (p_code_to_return ='1') THEN
		v_Sql:='SELECT TO_CHAR(DT.EM_EEI_IS_EDOC) FROM M_MOVEMENT MO INNER JOIN C_DOCTYPE DT ON MO.EM_SSRS_C_DOCTYPE_ID = DT.C_DOCTYPE_ID WHERE MO.M_MOVEMENT_ID= '''||p_identifier|| '''';
		EXECUTE IMMEDIATE v_Sql INTO v_Result;    
	END IF;
  
	IF (p_code_to_return ='2') THEN
		v_Sql:='SELECT TO_CHAR(DT.EM_EEI_EDOC_TYPE) FROM M_MOVEMENT MO INNER JOIN C_DOCTYPE DT ON MO.EM_SSRS_C_DOCTYPE_ID = DT.C_DOCTYPE_ID WHERE MO.M_MOVEMENT_ID= '''||p_identifier|| '''';
		EXECUTE IMMEDIATE v_Sql INTO v_Result;    
	END IF;
	IF (p_code_to_return ='3') THEN
		v_Sql:='SELECT TO_CHAR(EM_SSRS_M_SHIPPER_ID) FROM M_MOVEMENT WHERE M_MOVEMENT_ID= '''||p_identifier|| '''';
		EXECUTE IMMEDIATE v_Sql INTO v_Result;    
	END IF;
	IF (p_code_to_return ='4') THEN
		v_Sql:='SELECT TO_CHAR(MS.C_BPARTNER_ID) FROM M_MOVEMENT MO INNER JOIN M_SHIPPER MS ON MO.EM_SSRS_M_SHIPPER_ID = MS.M_SHIPPER_ID WHERE MO.M_MOVEMENT_ID= '''||p_identifier|| '''';
		EXECUTE IMMEDIATE v_Sql INTO v_Result;    
	END IF;
		  IF (p_code_to_return ='5') THEN
		v_Sql:='SELECT TO_CHAR(CP.NAME2) FROM M_MOVEMENT MO INNER JOIN M_SHIPPER MS ON MO.EM_SSRS_M_SHIPPER_ID = MS.M_SHIPPER_ID
		 INNER JOIN C_BPARTNER CP ON MS.C_BPARTNER_ID = CP.C_BPARTNER_ID  WHERE MO.M_MOVEMENT_ID='''||p_identifier|| '''';
		EXECUTE IMMEDIATE v_Sql INTO v_Result;    
	END IF;
	IF (p_code_to_return ='6') THEN
		v_Sql:='SELECT TO_CHAR(CP.EM_SSWH_TAXIDTYPE) FROM M_MOVEMENT MO INNER JOIN M_SHIPPER MS ON MO.EM_SSRS_M_SHIPPER_ID = MS.M_SHIPPER_ID
		 INNER JOIN C_BPARTNER CP ON MS.C_BPARTNER_ID = CP.C_BPARTNER_ID  WHERE MO.M_MOVEMENT_ID='''||p_identifier|| '''';
		EXECUTE IMMEDIATE v_Sql INTO v_Result;    
	END IF;
	IF (p_code_to_return ='7') THEN
		v_Sql:='SELECT TO_CHAR(TAXID) FROM M_MOVEMENT MO INNER JOIN M_SHIPPER MS ON MO.EM_SSRS_M_SHIPPER_ID = MS.M_SHIPPER_ID
		 INNER JOIN C_BPARTNER CP ON MS.C_BPARTNER_ID = CP.C_BPARTNER_ID  WHERE MO.M_MOVEMENT_ID='''||p_identifier|| '''';
		EXECUTE IMMEDIATE v_Sql INTO v_Result;    
	END IF;

	IF (p_code_to_return ='8') THEN
		v_Sql:='SELECT TO_CHAR(MS.DESCRIPTION) FROM M_MOVEMENT MO INNER JOIN M_SHIPPER MS ON 
		MO.EM_SSRS_M_SHIPPER_ID = MS.M_SHIPPER_ID WHERE MO.M_MOVEMENT_ID= '''||p_identifier|| '''';
		EXECUTE IMMEDIATE v_Sql INTO v_Result;    
	END IF;

	IF (p_code_to_return ='9') THEN
		v_Sql:='SELECT TO_CHAR(COALESCE(DT.EM_EEI_KEY_ACCESS_GENERATED,''N'')) FROM M_MOVEMENT MO INNER JOIN C_DOCTYPE DT ON MO.EM_SSRS_C_DOCTYPE_ID = DT.C_DOCTYPE_ID WHERE MO.M_MOVEMENT_ID= '''||p_identifier|| '''';
		EXECUTE IMMEDIATE v_Sql INTO v_Result;    
	END IF;

ELSE 

	v_Result:=NULL;
  

    END IF;
    RETURN(v_Result) ;
END EEI_GET_EXISTRESUPLY
]]></body>
    </function>
  </database>
