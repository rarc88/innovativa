<?xml version="1.0"?>
  <database name="VIEW M_PRODUCT_PRICE_WAREHOUSE_V">
    <view name="M_PRODUCT_PRICE_WAREHOUSE_V"><![CDATA[SELECT COALESCE(w.m_warehouse_id, '-') || pp.m_productprice_id AS m_product_price_warehouse_v_id, p.ad_client_id, p.ad_org_id, p.isactive, p.updated, p.updatedby, p.created, p.createdby, p.m_product_id, w.m_warehouse_id, pp.m_productprice_id, CASE WHEN p.producttype <> 'I' OR p.isstocked = 'N' THEN 99999 ELSE COALESCE((SELECT sum(sdd.qtyonhand) AS sum FROM m_storage_detail sdd JOIN m_locator l ON sdd.m_locator_id = l.m_locator_id WHERE sdd.m_product_id = p.m_product_id AND l.m_warehouse_id = w.m_warehouse_id), 0) - COALESCE((SELECT sum(sp.qtyreserved) AS sum FROM m_storage_pending sp WHERE sp.m_product_id = p.m_product_id AND sp.m_warehouse_id = w.m_warehouse_id), 0) END AS qty_available, CASE WHEN p.producttype <> 'I' OR p.isstocked = 'N' THEN 99999 ELSE COALESCE((SELECT sum(sdd.qtyonhand) AS sum FROM m_storage_detail sdd JOIN m_locator l ON sdd.m_locator_id = l.m_locator_id WHERE sdd.m_product_id = p.m_product_id AND l.m_warehouse_id = w.m_warehouse_id), 0) END AS qty_onhand, CASE WHEN p.producttype <> 'I' OR p.isstocked = 'N' THEN 0 ELSE COALESCE((SELECT sum(sp.qtyreserved) AS sum FROM m_storage_pending sp WHERE sp.m_product_id = p.m_product_id AND sp.m_warehouse_id = w.m_warehouse_id), 0) END AS qty_reserved, CASE WHEN p.producttype <> 'I' OR p.isstocked = 'N' THEN 0 ELSE COALESCE((SELECT sum(sp.qtyordered) AS sum FROM m_storage_pending sp WHERE sp.m_product_id = p.m_product_id AND sp.m_warehouse_id = w.m_warehouse_id), 0) END AS qty_ordered, pp.pricelist, pp.pricestd, pp.pricelimit, COALESCE(w.ad_org_id, '0') AS orgwarehouse FROM m_productprice pp LEFT JOIN m_warehouse w ON pp.ad_client_id = w.ad_client_id LEFT JOIN m_product p ON p.m_product_id = pp.m_product_id WHERE p.isgeneric = 'N' AND pp.isactive = 'Y' AND w.isactive = 'Y' AND p.isactive = 'Y']]></view>
  </database>
